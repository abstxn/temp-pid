#include <Arduino.h>
#include <IRremoteESP8266.h>
#include <IRrecv.h>
#include <IRsend.h>
#include <IRutils.h>

#define LED 2

#define IR_RECV_PIN 19
IRrecv irrecv(IR_RECV_PIN);
decode_results results;

#define IR_SEND_PIN 21
IRsend irsend(IR_SEND_PIN);

// Broadlink LED Strip
#define LED_STRIP_ON 0xF7C03F // 32 bits
#define LED_STRIP_OFF 0xF740BF //32 bits

// KDK Fan
#define TOGGLE_FAN 0x40040B218C80 // 48 bits

// Mitsubishi Electric A/C
uint16_t rawDataAcOn[431] = {3530, 1644,  502, 1226,  528, 1216,  502, 326,  544, 362,  504, 338,  530, 1224,  504, 338,  530, 366,  504, 1226,  516, 1220,  506, 366,  502, 1226,  502, 366,  504, 364,  508, 1224,  508, 1222,  506, 360,  504, 1224,  508, 1222,  522, 354,  504, 366,  502, 1226,  476, 396,  528, 340,  476, 1256,  502, 368,  502, 366,  506, 362,  476, 396,  504, 364,  504, 364,  502, 362,  476, 398,  506, 362,  528, 340,  474, 392,  516, 364,  478, 396,  532, 336,  530, 338,  530, 336,  530, 338,  528, 340,  534, 332,  514, 362,  476, 1256,  476, 396,  530, 336,  534, 330,  542, 332,  534, 334,  532, 1196,  478, 1254,  474, 400,  476, 396,  530, 340,  530, 336,  532, 336,  530, 1202,  474, 400,  532, 346,  504, 366,  530, 336,  476, 394,  530, 340,  564, 1178,  528, 1202,  532, 340,  532, 1194,  528, 1198,  502, 368,  530, 338,  530, 1198,  530, 1206,  544, 326,  530, 1200,  528, 1200,  528, 1204,  524, 1204,  526, 340,  446, 1286,  522, 344,  522, 344,  520, 1208,  472, 396,  518, 1208,  514, 1218,  490, 376,  446, 424,  488, 378,  488, 376,  474, 400,  480, 388,  482, 384,  448, 428,  482, 390,  480, 386,  472, 402,  476, 394,  474, 412,  454, 416,  448, 420,  424, 444,  428, 440,  446, 418,  448, 422,  424, 444,  448, 424,  424, 442,  422, 446,  444, 428,  444, 432,  416, 450,  442, 430,  416, 452,  414, 458,  412, 452,  414, 458,  412, 454,  438, 434,  412, 450,  442, 432,  414, 454,  416, 460,  440, 430,  440, 430,  412, 454,  412, 458,  414, 460,  414, 454,  412, 456,  414, 454,  440, 428,  412, 456,  412, 458,  412, 454,  410, 1316,  440, 1292,  410, 462,  438, 1292,  414, 454,  438, 1296,  438, 1318,  390, 458,  412, 17204,  3506, 1746,  414, 1328,  414, 1314,  388, 480,  388, 480,  388, 482,  388, 1342,  366, 502,  364, 504,  364, 1366,  362, 1368,  360, 506,  364, 1366,  398, 472,  388, 488,  388, 1340,  390, 1344,  388, 480,  390, 1342,  388, 1348,  362, 518,  362, 504,  362, 1390,  340, 530,  338, 502,  388, 1372,  336, 532,  338, 532,  336, 530,  336, 532,  338, 530,  338, 530,  338, 528,  362, 506,  362, 512,  336, 532,  362, 510,  338, 532,  360, 518,  336, 530,  362, 518,  338, 528,  336, 534,  336, 534,  334, 532,  338, 556,  308, 1420,  310, 554,  336, 534,  336, 534,  332, 536,  308, 560,  306, 1422,  332, 1396,  284, 610,  256, 586,  284, 610,  254, 608,  284, 590,  258, 1498,  230, 618,  248, 616,  254, 634,  234, 662,  228, 638,  230, 636,  210, 1524,  202, 1554,  202, 720,  112};  // MITSUBISHI_AC
uint8_t state[18] = {0x23, 0xCB, 0x26, 0x01, 0x00, 0x20, 0x18, 0x04, 0x36, 0x7B, 0x69, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6B};

void flash_led() {
  digitalWrite(LED, HIGH);
  delay(100);
  digitalWrite(LED, LOW);
}

void pulse_led_strip() {
  irsend.sendNEC(LED_STRIP_ON, 32);
  delay(1000);
  irsend.sendNEC(LED_STRIP_OFF, 32);
}

void setup() {
  Serial.begin(115200);
  pinMode(LED, OUTPUT);
  irrecv.enableIRIn();
  irsend.begin();
}

void loop() {

  irsend.sendMitsubishiAC((unsigned char*)state, 18);
  delay(2000);

  if (irrecv.decode(&results)) {

    Serial.println(resultToHumanReadableBasic(&results));

    irrecv.resume();
  }

  delay(10);
}

